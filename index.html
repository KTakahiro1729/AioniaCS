<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>慈悲なきアイオニア　非公式キャラクターシート</title>
    <script>
      window.gapiScriptLoaded = false;
      window.gisScriptLoaded = false;

      function vueGapiLoadedCallback() {
        console.log("index.html: Google API script (api.js) has loaded.");
        window.gapiScriptLoaded = true;
        if (
          window.vueApp &&
          typeof window.vueApp.handleGapiLoaded === "function"
        ) {
          window.vueApp.handleGapiLoaded();
        }
      }

      function vueGisLoadedCallback() {
        console.log(
          "index.html: Google GIS script (accounts.google.com/gsi/client) has loaded.",
        );
        window.gisScriptLoaded = true;
        if (
          window.vueApp &&
          typeof window.vueApp.handleGisLoaded === "function"
        ) {
          window.vueApp.handleGisLoaded();
        }
      }
    </script>
    <script
      async
      defer
      src="https://apis.google.com/js/api.js"
      onload="vueGapiLoadedCallback()"
    ></script>
    <script
      async
      defer
      src="https://accounts.google.com/gsi/client"
      onload="vueGisLoadedCallback()"
    ></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="assets/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Noto+Serif+JP:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <div id="app">
      <div class="top-left-controls">
        <div class="google-drive-button-container">
          <button
            class="button-base icon-button"
            title="Google Drive Menu"
            v-if="isGapiInitialized && isGisInitialized"
            @click="toggleDriveMenu"
            ref="driveMenuToggleButton"
          >
            <span
              class="icon-svg icon-svg-cloud"
              aria-label="Google Drive"
            ></span>
          </button>
          <div class="floating-menu" v-if="showDriveMenu" ref="driveMenu">
            <div
              class="menu-item status-message"
              id="floating_drive_status_message"
            >
              {{ driveStatusMessage }}
            </div>
            <button
              class="menu-item button-base"
              v-if="canSignInToGoogle"
              @click="handleSignInClick"
            >
              Sign In with Google
            </button>
            <button
              class="menu-item button-base"
              v-if="isSignedIn"
              @click="handleSignOutClick"
            >
              Sign Out
            </button>
            <button
              class="menu-item button-base"
              v-if="isSignedIn"
              @click="promptForDriveFolder(true)"
              :disabled="!isSignedIn"
            >
              Choose Drive Folder
            </button>
          </div>
        </div>
      </div>
      <div class="tool-title">Aionia TRPG Character Sheet</div>
      <div class="main-grid"></div>
      <div class="copyright-footer">
        <p>
          本サイトは<a
            href="https://www.aioniatrpg.com/"
            target="_blank"
            rel="noopener noreferrer"
            >「イチ（フシギ製作所）」様が権利を有する「慈悲なきアイオニア」</a
          >の二次創作物です(Ver 1.2対応)。<br />
          本サイトは<a
            href="https://bright-trpg.github.io/aionia_character_maker/"
            target="_blank"
            rel="noopener noreferrer"
            >bright-trpg様作成の「慈悲なきアイオニア　キャラクター作成用ツール」</a
          >をもとに、あろすてりっくが作成しました。
        </p>
      </div>

      <div class="main-footer">
        <div
          class="button-base footer-help-icon"
          ref="helpIcon"
          :class="{ 'footer-help-icon--fixed': helpState === 'fixed' }"
          @mouseover="handleHelpIconMouseOver"
          @mouseleave="handleHelpIconMouseLeave"
          @click="handleHelpIconClick"
          @keydown.enter.prevent="handleHelpIconClick"
          @keydown.space.prevent="handleHelpIconClick"
          title="ヘルプ表示"
          role="button"
          tabindex="0"
          aria-label="ヘルプを表示"
          :aria-expanded="isHelpVisible.toString()"
        >
          ？
        </div>
        <div :class="['status-display', experienceStatusClass]">
          経験点 {{ currentExperiencePoints }} / {{ maxExperiencePoints }}
        </div>
        <div class="status-display status-display--weight">
          荷重: {{ currentWeight }}
        </div>

        <div class="footer-button-container">
          <button
            class="button-base footer-button footer-button--save"
            @click="saveData"
          >
            データ保存
          </button>
          <button
            v-if="isSignedIn"
            class="button-base footer-button footer-button--cloud"
            @click="handleSaveToDriveClick"
            :disabled="!canOperateDrive"
            title="Google Driveに保存"
          >
            <span
              v-if="isCloudSaveSuccess"
              class="icon-svg icon-svg--footer icon-svg-success"
              aria-label="Save Succeeded"
            ></span>
            <span
              v-else
              class="icon-svg icon-svg--footer icon-svg-upload"
              aria-label="Save to Drive"
            ></span>
          </button>
        </div>

        <div class="footer-button-container">
          <label
            for="load_input_vue"
            class="button-base footer-button footer-button--load"
            >データ読込</label
          >
          <input
            type="file"
            id="load_input_vue"
            @change="handleFileUpload"
            accept=".json,.txt,.zip"
            class="hidden"
          />
          <button
            v-if="isSignedIn"
            class="button-base footer-button footer-button--cloud"
            @click="handleLoadFromDriveClick"
            :disabled="!isSignedIn"
            title="Google Driveから読込"
          >
            <span
              class="icon-svg icon-svg--footer icon-svg-download"
              aria-label="Load from Drive"
            ></span>
          </button>
        </div>

        <div
          class="button-base footer-button footer-button--output"
          @click="outputToCocofolia"
          ref="outputButton"
        >
          {{ outputButtonText }}
        </div>
        <transition name="fade">
          <div class="help-panel" ref="helpPanel" v-if="isHelpVisible">
            <button class="help-close" @click="closeHelpPanel">×</button>
            <div v-html="helpText"></div>
          </div>
        </transition>
      </div>
    </div>
    <script src="src/keyboard-handler.js"></script>
    <script src="src/cocofoliaExporter.js"></script>
    <script src="src/gameData.js"></script>
    <script src="src/imageManager.js"></script>
    <script src="src/utils.js"></script>
    <script src="src/dataManager.js"></script>
    <script src="src/googleDriveManager.js"></script>
    <script src="src/main.js"></script>
  </body>
</html>
