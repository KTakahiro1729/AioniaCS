import{_ as T,r as H,u as x,a as S,b as A,c as F,d as B,o as N,e as i,f as u,g as h,F as I,h as L,n as $,i as c,t as b,m as n}from"./index-Cazp79dY.js";const P={class:"character-hub"},j={key:0,class:"character-hub--list"},q=["onClick"],z={class:"character-hub--date"},E={key:0,class:"character-hub--actions-container"},G={key:1,class:"character-hub--actions-container"},O={class:"character-hub--actions-inline"},U=["onClick"],V=["onClick"],W=["onClick"],J={key:1,class:"character-hub--description"},K={__name:"CharacterHub",props:{dataManager:Object,loadCharacter:Function,saveToDrive:Function},emits:["sign-in","sign-out"],setup(v,{emit:Q}){const o=v,l=H(null),s=x();S();const{showToast:g,showAsyncToast:d}=A(),{showModal:m}=F(),p=B(()=>[...s.driveCharacters].sort((e,r)=>{const t=e.updatedAt?new Date(e.updatedAt).getTime():0;return(r.updatedAt?new Date(r.updatedAt).getTime():0)-t}));N(_);async function _(){s.isSignedIn&&s.driveCharacters.length===0&&o.dataManager.googleDriveManager&&await s.refreshDriveCharacters(o.dataManager.googleDriveManager)}async function f(e){o.saveToDrive&&await o.saveToDrive(e.id)}function C(e){return e?new Date(e).toLocaleString():""}async function D(e){(await m(n.characterHub.loadConfirm(e.characterName))).value==="load"&&await o.loadCharacter(e.id,e.characterName)}function k(e){l.value=e}function y(){l.value=null}async function M(){const e=l.value;if(e){if(o.dataManager.googleDriveManager)if(e.id.startsWith("temp-"))s.cancelPendingDriveSave(e.id),s.removeDriveCharacter(e.id),g({type:"success",...n.characterHub.delete.successToast()});else{const r=[...s.driveCharacters];s.removeDriveCharacter(e.id);const t=o.dataManager.googleDriveManager.deleteCharacterFile(e.id).catch(a=>{throw s.driveCharacters=r,a});d(t,{loading:n.characterHub.delete.asyncToast.loading(),success:n.characterHub.delete.asyncToast.success(),error:a=>n.characterHub.delete.asyncToast.error(a)}),await t}l.value=null}}async function w(e){const r=o.dataManager.googleDriveManager;if(!r)return;const t=r.loadCharacterFile(e.id).then(async a=>{a&&await o.dataManager.saveData(a.character,a.skills,a.specialSkills,a.equipments,a.histories)});d(t,{loading:n.characterHub.export.loading(),success:n.characterHub.export.success(),error:a=>n.characterHub.export.error(a)})}return(e,r)=>(u(),i("div",P,[h(s).isSignedIn?(u(),i("ul",j,[(u(!0),i(I,null,L(p.value,t=>(u(),i("li",{key:t.id,class:$(["character-hub--item",{"character-hub--item--highlighted":t.id===h(s).currentDriveFileId}])},[c("span",null,[c("button",{class:"character-hub--name",onClick:a=>D(t)},b(t.characterName||"名もなき冒険者"),9,q),c("span",z,b(C(t.updatedAt)),1)]),l.value&&l.value.id===t.id?(u(),i("div",E,[r[0]||(r[0]=c("p",{class:"character-hub--confirmation-message"},"本当に削除しますか？",-1)),c("div",{class:"character-hub--confirmation-actions"},[c("button",{class:"button-base button-compact",onClick:M},"はい"),c("button",{class:"button-base button-compact button-secondary",onClick:y},"いいえ")])])):(u(),i("div",G,[c("div",O,[c("button",{class:"button-base button-compact",onClick:a=>f(t)},"上書き保存",8,U),c("button",{class:"button-base button-compact",onClick:a=>w(t)},"端末保存",8,V),c("button",{class:"button-base button-compact",onClick:a=>k(t)},"削除",8,W)])]))],2))),128))])):(u(),i("p",J," Google Driveと連携して、キャラクターを保存・共有できます。ベータ版のため、データの破損・消失の危険性があります。 "))]))}},X=T(K,[["__scopeId","data-v-9b803e0d"]]);export{X as default};
