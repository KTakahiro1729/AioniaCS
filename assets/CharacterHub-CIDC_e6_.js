import{_ as y,u as M,a as H,b as T,c as S,d as x,o as A,e as i,f as u,g,F,r as B,n as N,h as n,t as m,m as o}from"./index-DAtvIR4F.js";const I={class:"character-hub"},L={key:0,class:"character-hub--list"},$=["onClick"],P={class:"character-hub--date"},j={class:"character-hub--actions-inline"},q=["onClick"],z=["onClick"],E=["onClick"],G={key:1,class:"character-hub--description"},O={__name:"CharacterHub",props:{dataManager:Object,loadCharacter:Function,saveToDrive:Function},emits:["sign-in","sign-out"],setup(v,{emit:U}){const s=v,r=M();H();const{showToast:b,showAsyncToast:d}=T(),{showModal:h}=S(),p=x(()=>[...r.driveCharacters].sort((e,c)=>{const t=e.updatedAt?new Date(e.updatedAt).getTime():0;return(c.updatedAt?new Date(c.updatedAt).getTime():0)-t}));A(_);async function _(){r.isSignedIn&&r.driveCharacters.length===0&&s.dataManager.googleDriveManager&&await r.refreshDriveCharacters(s.dataManager.googleDriveManager)}async function C(e){s.saveToDrive&&await s.saveToDrive(e.id,e.name)}function f(e){return e?new Date(e).toLocaleString():""}async function D(e){(await h(o.characterHub.loadConfirm(e.characterName||e.name))).value==="load"&&await s.loadCharacter(e.id,e.name)}async function k(e){if((await h(o.characterHub.deleteConfirm(e.characterName||e.name))).value==="delete"&&s.dataManager.googleDriveManager){if(e.id.startsWith("temp-")){r.cancelPendingDriveSave(e.id),r.removeDriveCharacter(e.id),b({type:"success",...o.characterHub.delete.successToast()});return}const t=[...r.driveCharacters];r.removeDriveCharacter(e.id);const a=s.dataManager.googleDriveManager.deleteCharacterFile(e.id).catch(l=>{throw r.driveCharacters=t,l});d(a,{loading:o.characterHub.delete.asyncToast.loading(),success:o.characterHub.delete.asyncToast.success(),error:l=>o.characterHub.delete.asyncToast.error(l)}),await a}}async function w(e){const c=s.dataManager.googleDriveManager;if(!c)return;const t=c.loadCharacterFile(e.id).then(async a=>{a&&await s.dataManager.saveData(a.character,a.skills,a.specialSkills,a.equipments,a.histories)});d(t,{loading:o.characterHub.export.loading(),success:o.characterHub.export.success(),error:a=>o.characterHub.export.error(a)})}return(e,c)=>(u(),i("div",I,[g(r).isSignedIn?(u(),i("ul",L,[(u(!0),i(F,null,B(p.value,t=>(u(),i("li",{key:t.id,class:N(["character-hub--item",{"character-hub--item--highlighted":t.id===g(r).currentDriveFileId}])},[n("button",{class:"character-hub--name",onClick:a=>D(t)},m(t.characterName||t.name),9,$),n("span",P,m(f(t.updatedAt)),1),n("div",j,[n("button",{class:"button-base button-compact",onClick:a=>C(t)},"上書き保存",8,q),n("button",{class:"button-base button-compact",onClick:a=>w(t)},"端末保存",8,z),n("button",{class:"button-base button-compact",onClick:a=>k(t)},"削除",8,E)])],2))),128))])):(u(),i("p",G," Google Driveと連携して、キャラクターを保存・共有できます。 "))]))}},W=y(O,[["__scopeId","data-v-5d5a153b"]]);export{W as default};
